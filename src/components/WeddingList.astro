---
// src/components/WeddingList.astro
import { getEventData } from "../data/eventData";
const { weddingList } = getEventData();
---

<section id="wedding-list" class="py-24" style="background: linear-gradient(to bottom, var(--color-primary) 50%, var(--color-watercolor) 100%);">
  <div class="mx-auto max-w-2xl px-6 text-center">
    <h2 
      class="text-3xl sm:text-4xl font-semibold tracking-[0.2em] uppercase mb-8"
      style="color: var(--color-secondary); font-family: 'TeX Gyre Termes', serif;"
    >
      {weddingList.title}
    </h2>
    
    <p 
      class="text-base sm:text-lg leading-relaxed mb-12 opacity-80"
      style="color: var(--color-secondary);"
    >
      {weddingList.message}
    </p>

    <div 
    class="rounded-3xl p-8 border-2 border-dashed inline-block w-full max-w-lg"
    style="border-color: var(--color-muted); background-color: rgba(255,255,255,0.2);"
  >
      <span class="block text-[10px] uppercase tracking-widest font-bold mb-2 opacity-60">IBAN</span>
      
      <!-- Usiamo uno span dedicato solo al testo dell'IBAN -->
      <code class="block text-sm sm:text-lg font-mono break-all mb-4" style="color: var(--color-secondary);">
        <span id="iban-to-copy">{weddingList.iban}</span>
      </code>
      
      <p class="text-xs mb-6 opacity-60 italic">{weddingList.name}</p>
      
      <button 
        id="copy-btn"
        class="px-8 py-3 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all active:scale-95 shadow-md"
        style="background-color: var(--color-secondary); color: #fff;"
      >
        Copia IBAN
      </button>
    </div>
  </div>
</section>

<script>
  // Funzione isolata per evitare interferenze
  const setupCopy = () => {
    const btn = document.getElementById('copy-btn');
    const text = document.getElementById('iban-to-copy');

    if (btn && text) {
      btn.onclick = () => {
        const iban = text.innerText.trim();
        navigator.clipboard.writeText(iban).then(() => {
          const originalText = btn.innerText;
          btn.innerText = "Copiato!";
          btn.style.backgroundColor = "#4ade80"; // Diventa verde temporaneamente
          
          setTimeout(() => {
            btn.innerText = originalText;
            btn.style.backgroundColor = "var(--color-secondary)";
          }, 2000);
        });
      };
    }
  };

  setupCopy();
  // Necessario se usi ViewTransitions di Astro
  document.addEventListener('astro:after-swap', setupCopy);
</script>