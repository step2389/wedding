---
import { getEventData } from "../data/eventData";
const { hero, countdown } = getEventData();

const heroData = hero;

// dati per il countdown, riusando la stessa struttura di Count.astro
const eventDate = countdown.target;
const eventLabel = countdown.label;
const eventHeading = countdown.heading;
const eventMessage = countdown.message;
const eventLocation = countdown.location;

---

<section
    id="hero"
    class="hero relative overflow-hidden [&_.section__inner]:max-w-none [&_.section__inner]:p-0"
    style={`
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-color: var(--color-primary);
    `}
>
    <div class="w-full px-6 py-20 md:py-28 lg:py-36">
        <div
            class="mx-auto flex w-full max-w-6xl flex-col gap-12 md:flex-row md:items-end"
        >
            <div class="space-y-6 text-left md:max-w-3xl">
                <p
                    class="text-xs uppercase tracking-[0.65em]"
                    style="color: var(--color-secondary); opacity: 0.7;"
                >
                    {hero.tagline}
                </p>
                <h1
                    class="font-display text-[clamp(3.5rem,8vw,6.5rem)] uppercase leading-[0.88] tracking-tight drop-shadow-md"
                    id="hero-heading"
                    data-hero-title={hero.title}
                    style="color: var(--color-background);"
                >
                    {hero.title}
                </h1>
                <p
                    class="max-w-2xl text-base leading-relaxed md:text-lg"
                    style="color: var(--color-secondary); opacity: 0.9;"
                >
                    {hero.description}
                </p>
            </div>

            <div class="text-left md:text-right">
                <p
                    class="text-xs uppercase tracking-[0.45em]"
                    style="color: var(--color-secondary); opacity: 0.7;"
                >
                    {hero.weekday}
                </p>
                <p
                    class="font-display text-4xl uppercase tracking-[0.2em]"
                    style="color: var(--color-background);"
                >
                    {hero.dateDisplay}
                </p>
                <p
                    class="mt-4 text-sm font-semibold uppercase tracking-[0.35em]"
                    style="color: var(--color-secondary); opacity: 0.7;"
                >
                    {hero.location}
                </p>
            </div>
        </div>
    </div>
  
</section>
<!-- Countdown compatto dentro l'hero -->
<section
  class="mt-12 flex flex-col items-center gap-4 text-center"
  data-countdown
  data-countdown-target={eventDate}
>
  <p
    class="text-[11px] uppercase tracking-[0.35em]"
    style="color: var(--color-accent);"
  >
    {eventLabel}
  </p>

  <div class="flex items-baseline gap-4 text-[13px] uppercase tracking-[0.25em]">
    <div class="flex flex-col items-center">
      <span
        class="text-2xl font-semibold"
        style="color: var(--color-primary);"
        data-days
      >
        --
      </span>
      <span class="text-[10px]" style="color: var(--color-accent);">Giorni</span>
    </div>
    <div class="flex flex-col items-center">
      <span
        class="text-2xl font-semibold"
        style="color: var(--color-primary);"
        data-hours
      >
        --
      </span>
      <span class="text-[10px]" style="color: var(--color-accent);">Ore</span>
    </div>
    <div class="flex flex-col items-center">
      <span
        class="text-2xl font-semibold"
        style="color: var(--color-primary);"
        data-minutes
      >
        --
      </span>
      <span class="text-[10px]" style="color: var(--color-accent);">Min</span>
    </div>
    <div class="flex flex-col items-center">
      <span
        class="text-2xl font-semibold"
        style="color: var(--color-primary);"
        data-seconds
      >
        --
      </span>
      <span class="text-[10px]" style="color: var(--color-accent);">Sec</span>
    </div>
  </div>

  <p
    class="text-[11px] uppercase tracking-[0.25em] mt-2"
    style="color: var(--color-accent);"
  >
    {eventLocation}
  </p>
</section>

<script>
    import gsap from "gsap";
    import { ScrambleTextPlugin } from "gsap/ScrambleTextPlugin";
    gsap.registerPlugin(ScrambleTextPlugin);

    requestAnimationFrame(() => {
        const heading = document.querySelector("#hero-heading");
        if (!heading) return;
        const targetText =
            heading.dataset.heroTitle ?? heading.textContent ?? "";
        gsap.to(heading, {
            scrambleText: {
                text: targetText,
                revealDelay: 0.2,
                tweenLength: true,
            },
            ease: "power2.inOut",
            overwrite: "auto",
            duration: 1,
        });
    });   
</script>

<script type="module">
  const initCountdown = () => {
    const root = document.querySelector("[data-countdown]");
    if (!root) {
      return;
    }

    const targetDate = root.dataset.countdownTarget;
    if (!targetDate) {
      return;
    }

    const pad = (value) => String(value).padStart(2, "0");
    const targets = {
      days: root.querySelector("[data-days]"),
      hours: root.querySelector("[data-hours]"),
      minutes: root.querySelector("[data-minutes]"),
      seconds: root.querySelector("[data-seconds]"),
    };

    let timer;

    const updateCountdown = () => {
      const now = Date.now();
      const eventTime = new Date(targetDate).getTime();
      const remaining = Math.max(eventTime - now, 0);

      const seconds = Math.floor(remaining / 1000);
      const days = Math.floor(seconds / 86400);
      const hours = Math.floor((seconds % 86400) / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;

      if (targets.days) targets.days.textContent = pad(days);
      if (targets.hours) targets.hours.textContent = pad(hours);
      if (targets.minutes) targets.minutes.textContent = pad(minutes);
      if (targets.seconds) targets.seconds.textContent = pad(secs);

      if (remaining <= 0) {
        clearInterval(timer);
      }
    };

    updateCountdown();
    timer = setInterval(updateCountdown, 1000);
  };

  initCountdown();
</script>